<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Using custom mean function · Pioran.jl</title><meta name="title" content="Using custom mean function · Pioran.jl"/><meta property="og:title" content="Using custom mean function · Pioran.jl"/><meta property="twitter:title" content="Using custom mean function · Pioran.jl"/><meta name="description" content="Pioran.jl: A Julia package for power spectral density estimation using scalable Gaussian processes."/><meta property="og:description" content="Pioran.jl: A Julia package for power spectral density estimation using scalable Gaussian processes."/><meta property="twitter:description" content="Pioran.jl: A Julia package for power spectral density estimation using scalable Gaussian processes."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.svg" alt="Pioran.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">Pioran.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../getting_started/">Getting Started</a></li><li><span class="tocitem">Basic usage</span><ul><li><a class="tocitem" href="../explanation/">Spectral analysis in Pioran</a></li><li><a class="tocitem" href="../modelling/">Modelling</a></li><li><a class="tocitem" href="../simulations/">Simulations</a></li><li><a class="tocitem" href="../timeseries/">Time series and priors</a></li><li><a class="tocitem" href="../diagnostics/">Diagnostics post-inference</a></li><li><a class="tocitem" href="../basis_functions/">About the basis functions</a></li></ul></li><li><span class="tocitem">Inference</span><ul><li><a class="tocitem" href="../turing/">Hamiltonian Monte Carlo with Turing.jl</a></li><li><a class="tocitem" href="../ultranest/">Nested sampling with ultranest</a></li></ul></li><li><span class="tocitem">Advanced modelling</span><ul><li class="is-active"><a class="tocitem" href>Using custom mean function</a><ul class="internal"><li><a class="tocitem" href="#Implementation"><span>Implementation</span></a></li><li><a class="tocitem" href="#Sampling-from-the-GP"><span>Sampling from the GP</span></a></li><li><a class="tocitem" href="#Inference"><span>Inference</span></a></li></ul></li><li><a class="tocitem" href="../adding_features/">Modelling features in the power spectrum</a></li></ul></li><li><a class="tocitem" href="../carma/">CARMA</a></li><li><a class="tocitem" href="../bibliography/">Bibliography</a></li><li><a class="tocitem" href="../api/">API Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Advanced modelling</a></li><li class="is-active"><a href>Using custom mean function</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Using custom mean function</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/mlefkir/Pioran.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/mlefkir/Pioran.jl/blob/main/docs/src/custom_mean.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Using-custom-mean-function"><a class="docs-heading-anchor" href="#Using-custom-mean-function">Using custom mean function</a><a id="Using-custom-mean-function-1"></a><a class="docs-heading-anchor-permalink" href="#Using-custom-mean-function" title="Permalink"></a></h1><p>In some cases, we want to use a mean function that is not constant over time. For instance, this can be useful when one wants to model a periodic signal embedded in red noise.</p><p>Let&#39;s say we want to model a mean function of the form:</p><p class="math-container">\[m(t ; A, T_0, \phi,\mu) = A \sin{(2\pi t / T_0 +\phi)} +\mu\]</p><p>and the broadband noise is modelled with a power-law power spectrum, typical for the variability of active galaxies.</p><h2 id="Implementation"><a class="docs-heading-anchor" href="#Implementation">Implementation</a><a id="Implementation-1"></a><a class="docs-heading-anchor-permalink" href="#Implementation" title="Permalink"></a></h2><pre><code class="language-julia hljs">using Plots
using Pioran
using Random
using Distributions</code></pre><p>To use a custom mean function, first define the function like:</p><pre><code class="language-julia hljs">mean_function(x, A=A, ϕ=ϕ, T₀=T₀, μ=μ) = @. A * sin(2π * x / T₀ + ϕ) + μ</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">mean_function (generic function with 5 methods)</code></pre><p>Then, create a <code>CustomMean</code> struct with the function as an argument:</p><pre><code class="language-julia hljs">μ_fun = CustomMean(mean_function)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">CustomMean{typeof(Main.mean_function)}(Main.mean_function)</code></pre><p>And use it in the <a href="../api/#Pioran.ScalableGP"><code>ScalableGP</code></a> struct like any mean value and that&#39;s it! This whole process can be summarised in a function as follows:</p><pre><code class="language-julia hljs">function GP_model(t, y, σ, params)

    α₁, f₁, α₂, variance, ν, μ, A, ϕ, T₀ = params

    T = (t[end] - t[1]) # duration of the time series
    Δt = minimum(diff(t)) # min time separation
    f_min, f_max = 1 / T, 1 / Δt / 2

    # Rescale the measurement variance
    σ² = ν .* σ .^ 2

    # Define the mean
    mean_function(x, A=A, ϕ=ϕ, T₀=T₀, μ=μ) = @. A * sin(2π * x / T₀ + ϕ) + μ
    μ_fun = CustomMean(mean_function)

    # Define the power spectral density function
    𝓟 = SingleBendingPowerLaw(α₁, f₁, α₂)

    # Approximate  the PSD to form a covariance function
    𝓡 = approx(𝓟, f_min, f_max, 20, variance, basis_function=&quot;SHO&quot;)

    # Build the GP using the mean function and (auto)covariance function
    f = ScalableGP(μ_fun, 𝓡)

    # Condition on the times and errors of the observation
    fx = f(t, σ²)
    return fx
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">GP_model (generic function with 1 method)</code></pre><h2 id="Sampling-from-the-GP"><a class="docs-heading-anchor" href="#Sampling-from-the-GP">Sampling from the GP</a><a id="Sampling-from-the-GP-1"></a><a class="docs-heading-anchor-permalink" href="#Sampling-from-the-GP" title="Permalink"></a></h2><p>We first define the GP to sample from:</p><pre><code class="language-julia hljs">t = LinRange(0,2000,200)
σ = 0.5 * ones(length(t))

params = [0.3,1e-2,2.9,1.03,1.0,0.2,2.3,0.3,320]
GP = GP_model(t, nothing, σ, params)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">AbstractGPs.FiniteGP{ScalableGP{AbstractGPs.GP{CustomMean{Main.var&quot;#mean_function#1&quot;{Float64, Float64, Float64, Float64}}, Pioran.SumOfCelerite{StructArrays.StructArray{&lt;:Pioran.SemiSeparable}}}, Pioran.SumOfCelerite{StructArrays.StructArray{&lt;:Pioran.SemiSeparable}}, Symbol}, LinRange{Float64, Int64}, LinearAlgebra.Diagonal{Float64, Vector{Float64}}}(
f: ScalableGP{AbstractGPs.GP{CustomMean{Main.var&quot;#mean_function#1&quot;{Float64, Float64, Float64, Float64}}, Pioran.SumOfCelerite{StructArrays.StructArray{&lt;:Pioran.SemiSeparable}}}, Pioran.SumOfCelerite{StructArrays.StructArray{&lt;:Pioran.SemiSeparable}}, Symbol}(AbstractGPs.GP{CustomMean{Main.var&quot;#mean_function#1&quot;{Float64, Float64, Float64, Float64}}, Pioran.SumOfCelerite{StructArrays.StructArray{&lt;:Pioran.SemiSeparable}}}(CustomMean{Main.var&quot;#mean_function#1&quot;{Float64, Float64, Float64, Float64}}(Main.var&quot;#mean_function#1&quot;{Float64, Float64, Float64, Float64}(2.3, 0.3, 320.0, 0.2)), Pioran.SumOfCelerite{StructArrays.StructArray{&lt;:Pioran.SemiSeparable}}(Celerite[Celerite(0.005679255783333235, 0.005679255783333235, 0.00011107207345395915, 0.00011107207345395915), Celerite(0.005056818936868288, 0.005056818936868288, 0.0001939563435589432, 0.0001939563435589432), Celerite(0.010016973412992233, 0.010016973412992233, 0.0003386905640358681, 0.0003386905640358681), Celerite(0.011051151646984954, 0.011051151646984954, 0.0005914284424117007, 0.0005914284424117007), Celerite(0.022740132105458825, 0.022740132105458825, 0.0010327645338725382, 0.0010327645338725382), Celerite(0.022446339643001457, 0.022446339643001457, 0.001803434711519142, 0.001803434711519142), Celerite(0.05279759973104132, 0.05279759973104132, 0.0031491948571440134, 0.0031491948571440134), Celerite(0.04481525644925057, 0.04481525644925057, 0.005499188955894198, 0.005499188955894198), Celerite(0.13122035327935017, 0.13122035327935017, 0.009602797078124968, 0.009602797078124968), Celerite(0.1260602178395168, 0.1260602178395168, 0.016768602145377818, 0.016768602145377818), Celerite(0.6217736149319335, 0.6217736149319335, 0.029281678621586957, 0.029281678621586957), Celerite(0.8770572162926112, 0.8770572162926112, 0.05113227062485024, 0.05113227062485024), Celerite(0.2882612435546154, 0.2882612435546154, 0.0892882246622794, 0.0892882246622794), Celerite(0.08219135777553364, 0.08219135777553364, 0.15591693789297742, 0.15591693789297742), Celerite(0.028538171673376533, 0.028538171673376533, 0.2722653699731647, 0.2722653699731647), Celerite(0.009632907700215713, 0.009632907700215713, 0.4754353996966427, 0.4754353996966427), Celerite(0.0033491594631901243, 0.0033491594631901243, 0.8302150923820582, 0.8302150923820582), Celerite(0.001190259180458787, 0.001190259180458787, 1.4497387027948254, 1.4497387027948254), Celerite(0.00035134464676607236, 0.00035134464676607236, 2.5315635979958984, 2.5315635979958984), Celerite(0.0002191600720433031, 0.0002191600720433031, 4.420668523467678, 4.420668523467678)], [0.005679255783333235, 0.005056818936868288, 0.010016973412992233, 0.011051151646984954, 0.022740132105458825, 0.022446339643001457, 0.05279759973104132, 0.04481525644925057, 0.13122035327935017, 0.1260602178395168, 0.6217736149319335, 0.8770572162926112, 0.2882612435546154, 0.08219135777553364, 0.028538171673376533, 0.009632907700215713, 0.0033491594631901243, 0.001190259180458787, 0.00035134464676607236, 0.0002191600720433031], [0.005679255783333235, 0.005056818936868288, 0.010016973412992233, 0.011051151646984954, 0.022740132105458825, 0.022446339643001457, 0.05279759973104132, 0.04481525644925057, 0.13122035327935017, 0.1260602178395168, 0.6217736149319335, 0.8770572162926112, 0.2882612435546154, 0.08219135777553364, 0.028538171673376533, 0.009632907700215713, 0.0033491594631901243, 0.001190259180458787, 0.00035134464676607236, 0.0002191600720433031], [0.00011107207345395915, 0.0001939563435589432, 0.0003386905640358681, 0.0005914284424117007, 0.0010327645338725382, 0.001803434711519142, 0.0031491948571440134, 0.005499188955894198, 0.009602797078124968, 0.016768602145377818, 0.029281678621586957, 0.05113227062485024, 0.0892882246622794, 0.15591693789297742, 0.2722653699731647, 0.4754353996966427, 0.8302150923820582, 1.4497387027948254, 2.5315635979958984, 4.420668523467678], [0.00011107207345395915, 0.0001939563435589432, 0.0003386905640358681, 0.0005914284424117007, 0.0010327645338725382, 0.001803434711519142, 0.0031491948571440134, 0.005499188955894198, 0.009602797078124968, 0.016768602145377818, 0.029281678621586957, 0.05113227062485024, 0.0892882246622794, 0.15591693789297742, 0.2722653699731647, 0.4754353996966427, 0.8302150923820582, 1.4497387027948254, 2.5315635979958984, 4.420668523467678])), Pioran.SumOfCelerite{StructArrays.StructArray{&lt;:Pioran.SemiSeparable}}(Celerite[Celerite(0.005679255783333235, 0.005679255783333235, 0.00011107207345395915, 0.00011107207345395915), Celerite(0.005056818936868288, 0.005056818936868288, 0.0001939563435589432, 0.0001939563435589432), Celerite(0.010016973412992233, 0.010016973412992233, 0.0003386905640358681, 0.0003386905640358681), Celerite(0.011051151646984954, 0.011051151646984954, 0.0005914284424117007, 0.0005914284424117007), Celerite(0.022740132105458825, 0.022740132105458825, 0.0010327645338725382, 0.0010327645338725382), Celerite(0.022446339643001457, 0.022446339643001457, 0.001803434711519142, 0.001803434711519142), Celerite(0.05279759973104132, 0.05279759973104132, 0.0031491948571440134, 0.0031491948571440134), Celerite(0.04481525644925057, 0.04481525644925057, 0.005499188955894198, 0.005499188955894198), Celerite(0.13122035327935017, 0.13122035327935017, 0.009602797078124968, 0.009602797078124968), Celerite(0.1260602178395168, 0.1260602178395168, 0.016768602145377818, 0.016768602145377818), Celerite(0.6217736149319335, 0.6217736149319335, 0.029281678621586957, 0.029281678621586957), Celerite(0.8770572162926112, 0.8770572162926112, 0.05113227062485024, 0.05113227062485024), Celerite(0.2882612435546154, 0.2882612435546154, 0.0892882246622794, 0.0892882246622794), Celerite(0.08219135777553364, 0.08219135777553364, 0.15591693789297742, 0.15591693789297742), Celerite(0.028538171673376533, 0.028538171673376533, 0.2722653699731647, 0.2722653699731647), Celerite(0.009632907700215713, 0.009632907700215713, 0.4754353996966427, 0.4754353996966427), Celerite(0.0033491594631901243, 0.0033491594631901243, 0.8302150923820582, 0.8302150923820582), Celerite(0.001190259180458787, 0.001190259180458787, 1.4497387027948254, 1.4497387027948254), Celerite(0.00035134464676607236, 0.00035134464676607236, 2.5315635979958984, 2.5315635979958984), Celerite(0.0002191600720433031, 0.0002191600720433031, 4.420668523467678, 4.420668523467678)], [0.005679255783333235, 0.005056818936868288, 0.010016973412992233, 0.011051151646984954, 0.022740132105458825, 0.022446339643001457, 0.05279759973104132, 0.04481525644925057, 0.13122035327935017, 0.1260602178395168, 0.6217736149319335, 0.8770572162926112, 0.2882612435546154, 0.08219135777553364, 0.028538171673376533, 0.009632907700215713, 0.0033491594631901243, 0.001190259180458787, 0.00035134464676607236, 0.0002191600720433031], [0.005679255783333235, 0.005056818936868288, 0.010016973412992233, 0.011051151646984954, 0.022740132105458825, 0.022446339643001457, 0.05279759973104132, 0.04481525644925057, 0.13122035327935017, 0.1260602178395168, 0.6217736149319335, 0.8770572162926112, 0.2882612435546154, 0.08219135777553364, 0.028538171673376533, 0.009632907700215713, 0.0033491594631901243, 0.001190259180458787, 0.00035134464676607236, 0.0002191600720433031], [0.00011107207345395915, 0.0001939563435589432, 0.0003386905640358681, 0.0005914284424117007, 0.0010327645338725382, 0.001803434711519142, 0.0031491948571440134, 0.005499188955894198, 0.009602797078124968, 0.016768602145377818, 0.029281678621586957, 0.05113227062485024, 0.0892882246622794, 0.15591693789297742, 0.2722653699731647, 0.4754353996966427, 0.8302150923820582, 1.4497387027948254, 2.5315635979958984, 4.420668523467678], [0.00011107207345395915, 0.0001939563435589432, 0.0003386905640358681, 0.0005914284424117007, 0.0010327645338725382, 0.001803434711519142, 0.0031491948571440134, 0.005499188955894198, 0.009602797078124968, 0.016768602145377818, 0.029281678621586957, 0.05113227062485024, 0.0892882246622794, 0.15591693789297742, 0.2722653699731647, 0.4754353996966427, 0.8302150923820582, 1.4497387027948254, 2.5315635979958984, 4.420668523467678]), :celerite)
x: LinRange{Float64}(0.0, 2000.0, 200)
Σy: [0.25 0.0 … 0.0 0.0; 0.0 0.25 … 0.0 0.0; … ; 0.0 0.0 … 0.25 0.0; 0.0 0.0 … 0.0 0.25]
)
</code></pre><p>We now sample a few realisations from the GP and see that the realisations are indeed periodic.</p><pre><code class="language-julia hljs">rng = MersenneTwister(12)
y = [rand(rng,GP) for i in 1:3]
Plots.scatter(t,y,yerr=σ,xlabel=&quot;Time&quot;,ylabel=&quot;Value&quot;,legend=false,framestyle = :box,ms=3)</code></pre><img src="2569627f.svg" alt="Example block output"/><h2 id="Inference"><a class="docs-heading-anchor" href="#Inference">Inference</a><a id="Inference-1"></a><a class="docs-heading-anchor-permalink" href="#Inference" title="Permalink"></a></h2><p>To use such process for inference it is as easy as before. You need to get the loglikelihood using the <code>logpdf</code> function as follows:</p><pre><code class="language-julia hljs">GP = GP_model(t,y, σ, params)
logpdf(GP,y[1])</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">-310.86672106653333</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../ultranest/">« Nested sampling with ultranest</a><a class="docs-footer-nextpage" href="../adding_features/">Modelling features in the power spectrum »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Monday 8 September 2025 12:03">Monday 8 September 2025</span>. Using Julia version 1.10.10.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
