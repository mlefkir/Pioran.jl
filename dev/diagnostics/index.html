<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Diagnostics post-inference · Pioran.jl</title><meta name="title" content="Diagnostics post-inference · Pioran.jl"/><meta property="og:title" content="Diagnostics post-inference · Pioran.jl"/><meta property="twitter:title" content="Diagnostics post-inference · Pioran.jl"/><meta name="description" content="Pioran.jl: A Julia package for power spectral density estimation using scalable Gaussian processes."/><meta property="og:description" content="Pioran.jl: A Julia package for power spectral density estimation using scalable Gaussian processes."/><meta property="twitter:description" content="Pioran.jl: A Julia package for power spectral density estimation using scalable Gaussian processes."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.svg" alt="Pioran.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">Pioran.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../getting_started/">Getting Started</a></li><li><span class="tocitem">Basic usage</span><ul><li><a class="tocitem" href="../explanation/">Spectral analysis in Pioran</a></li><li><a class="tocitem" href="../modelling/">Modelling</a></li><li><a class="tocitem" href="../simulations/">Simulations</a></li><li><a class="tocitem" href="../timeseries/">Time series and priors</a></li><li class="is-active"><a class="tocitem" href>Diagnostics post-inference</a><ul class="internal"><li><a class="tocitem" href="#In-the-Fourier-domain"><span>In the Fourier domain</span></a></li><li><a class="tocitem" href="#In-the-time-domain"><span>In the time domain</span></a></li></ul></li><li><a class="tocitem" href="../basis_functions/">About the basis functions</a></li></ul></li><li><span class="tocitem">Inference</span><ul><li><a class="tocitem" href="../turing/">Hamiltonian Monte Carlo with Turing.jl</a></li><li><a class="tocitem" href="../ultranest/">Nested sampling with ultranest</a></li></ul></li><li><span class="tocitem">Advanced modelling</span><ul><li><a class="tocitem" href="../custom_mean/">Using custom mean function</a></li><li><a class="tocitem" href="../adding_features/">Modelling features in the power spectrum</a></li></ul></li><li><a class="tocitem" href="../carma/">CARMA</a></li><li><a class="tocitem" href="../bibliography/">Bibliography</a></li><li><a class="tocitem" href="../api/">API Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Basic usage</a></li><li class="is-active"><a href>Diagnostics post-inference</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Diagnostics post-inference</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/mlefkir/Pioran.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/mlefkir/Pioran.jl/blob/main/docs/src/diagnostics.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Diagnostics-post-inference"><a class="docs-heading-anchor" href="#Diagnostics-post-inference">Diagnostics post-inference</a><a id="Diagnostics-post-inference-1"></a><a class="docs-heading-anchor-permalink" href="#Diagnostics-post-inference" title="Permalink"></a></h1><p>After performing inference, we can use the Gaussian process to diagnose the quality of the fit. This can be done in the time domain or the frequency domain.</p><p>In this section, we will work with the following time series <code>y</code> with measurement error <code>yerr</code> indexed by time <code>t</code>.</p><pre><code class="language-julia hljs">using DelimitedFiles
using Plots
using CairoMakie
using MCMCChains
using PairPlots
using Pioran
using Random

data = readdlm(&quot;data/subset_simu_single_subset_time_series.txt&quot;,comments=true)
t, y, yerr = data[:,1], data[:,2], data[:,3]
Plots.scatter(t, y,yerr=yerr, label=&quot;data&quot;,xlabel=&quot;Time (days)&quot;,ylabel=&quot;Value&quot;,legend=false,framestyle = :box,ms=3)</code></pre><img src="9d7b52a1.svg" alt="Example block output"/><p>Let&#39;s take posterior samples from a run of the inference with <code>ultranest</code> and plot the pairplot of the samples.</p><pre><code class="language-julia hljs">data = readdlm(&quot;data/inference/chains/equal_weighted_post.txt&quot;, comments=true)
samples = convert(Array{Float64},reshape(Array(data[2:end,:]),(size(data[2:end,:])...,1)))
c = Chains(samples,data[1,:])
pairplot(c)</code></pre><img src="6972e0b1.png" alt="Example block output"/><p>We can now use the function <a href="../api/#Pioran.run_posterior_predict_checks-NTuple{9, Any}"><code>run_posterior_predict_checks</code></a> to perform the diagnostics. This function calls several other functions to plot the graphical diagnostics.</p><pre><code class="language-julia hljs">f0, fM = 1 / (t[end] - t[1])/4.0, 1 / minimum(diff(t)) / 2 * 4.0
basis_function = &quot;SHO&quot;
n_components = 20
model = SingleBendingPowerLaw
paramnames = data[1,:]
array = data[2:end,:]</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">6191×7 Matrix{Any}:
 0.696778  0.00295622  2.54877  …  1.11704    0.48407      2.37838e-5
 1.14882   0.0125038   3.1593      1.07506    0.173744     0.000121685
 1.12806   0.00376592  2.82925     0.987719   0.652464     0.000338202
 0.35729   0.00213092  2.76632     0.959707   0.357615     4.44739e-6
 0.507734  0.00262427  2.81882     0.969674   0.291513     0.00124111
 0.79309   0.00783003  3.5739   …  1.19599    0.152513     1.88203e-6
 0.521578  0.00592803  2.97459     1.03736    0.277896     4.22953e-5
 0.979505  0.00791432  3.33333     1.35453    0.0530084    0.00248094
 0.68002   0.00257445  2.44408     1.01985    0.183394     0.000101945
 0.582614  0.00419094  3.00525     1.25601   -0.345007     0.00108161
 ⋮                              ⋱             ⋮            
 0.737521  0.00836645  2.98214     0.91934    0.163393     2.91151e-6
 0.774934  0.0160586   3.54052     0.806934   0.0693059    0.00330326
 0.296263  0.00153782  2.50223     1.05533    0.352117     0.00160173
 0.390908  0.00205682  2.18926  …  0.781045   0.25945      3.99982e-6
 0.322226  0.00537511  2.8954      1.19504    0.347022     8.14029e-6
 0.94519   0.0125508   3.43676     0.8425     0.0372545    8.46856e-6
 0.814284  0.00121973  2.54089     1.18884    0.182327     3.9866e-6
 0.711486  0.00703952  3.40933     1.10685    0.199357     0.00114942
 0.328705  0.00442217  3.1288   …  1.38679   -0.000307503  1.55874e-5</code></pre><p>This function requires a function <code>GP_model</code> to describe the GP model used and it requires the dictionary <code>paramnames_split</code> to split the parameters between the PSD model, the mean or the errors.</p><pre><code class="language-julia hljs">function GP_model(t, y, σ, params, basis_function=basis_function, n_components=n_components, model=model)

    T = (t[end] - t[1]) # duration of the time series
    Δt = minimum(diff(t)) # min time separation

    f_min, f_max = 1 / T, 1 / Δt / 2

    α₁, f₁, α₂, variance, ν, μ, c = params

    # Rescale the measurement variance
    σ² = ν .* σ .^ 2  ./ (y.-c).^2

    # Define power spectral density function
    𝓟 = model(α₁, f₁, α₂)

    # Approximation of the PSD to form a covariance function
    𝓡 = approx(𝓟, f_min, f_max, n_components, variance, basis_function=basis_function)

    # Build the GP
    f = ScalableGP(μ, 𝓡)

    # Condition on the times and errors
    fx = f(t, σ²)
    return fx
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">GP_model (generic function with 4 methods)</code></pre><p>The associated <code>paramnames_split</code> can be written as follows:</p><pre><code class="language-julia hljs">paramnames_split = Dict(&quot;psd&quot; =&gt; [&quot;α₁&quot;, &quot;f₁&quot;, &quot;α₂&quot;],
        &quot;norm&quot; =&gt; &quot;variance&quot;,
        &quot;scale_err&quot; =&gt; &quot;ν&quot;,
        &quot;log_transform&quot; =&gt;&quot;c&quot;,
        &quot;mean&quot; =&gt; &quot;μ&quot;)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Dict{String, Any} with 5 entries:
  &quot;log_transform&quot; =&gt; &quot;c&quot;
  &quot;scale_err&quot;     =&gt; &quot;ν&quot;
  &quot;norm&quot;          =&gt; &quot;variance&quot;
  &quot;mean&quot;          =&gt; &quot;μ&quot;
  &quot;psd&quot;           =&gt; [&quot;α₁&quot;, &quot;f₁&quot;, &quot;α₂&quot;]</code></pre><pre><code class="language-julia hljs">figs = run_posterior_predict_checks(array, paramnames,paramnames_split, t, y, yerr, model,GP_model, true; S_low=20., S_high=20., path=&quot;&quot;, basis_function=basis_function, n_components=n_components, is_integrated_power=false)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">4-element Vector{Any}:
 Figure()
 Figure()
 Figure()
 Figure()</code></pre><h2 id="In-the-Fourier-domain"><a class="docs-heading-anchor" href="#In-the-Fourier-domain">In the Fourier domain</a><a id="In-the-Fourier-domain-1"></a><a class="docs-heading-anchor-permalink" href="#In-the-Fourier-domain" title="Permalink"></a></h2><p>We can plot the posterior predictive distribution of the power spectral density and the approximate power spectral density. We can verify if the approximation is valid with the posterior samples. The noise level is given by <span>$2 \nu \sigma^2_{\rm yerr}\Delta t$</span>.</p><p>This figure is plotted using the function <a href="../api/#Pioran.plot_psd_ppc-NTuple{7, Any}"><code>Pioran.plot_psd_ppc</code></a>.</p><pre><code class="language-julia hljs">figs[1]</code></pre><img src="768d64ca.png" alt="Example block output"/><p>A second diagnostic in the frequency domain is the posterior predictive periodograms using the Lomb-Scargle periodogram of simulated data. Using the posterior samples, we can draw realisations of the process at the same instants <code>t</code> and compute the Lomb-Scargle periodogram for each realisation. To do so, we use the package <a href="https://github.com/JuliaAstro/LombScargle.jl"><code>LombScargle.jl</code></a>. We can then compare the median of the periodogram with the periodogram of the data. This figure is plotted using the function <a href="../api/#Pioran.plot_lsp_ppc-NTuple{5, Any}"><code>Pioran.plot_lsp_ppc</code></a>.</p><pre><code class="language-julia hljs">figs[2]</code></pre><img src="f5d38cf4.png" alt="Example block output"/><h2 id="In-the-time-domain"><a class="docs-heading-anchor" href="#In-the-time-domain">In the time domain</a><a id="In-the-time-domain-1"></a><a class="docs-heading-anchor-permalink" href="#In-the-time-domain" title="Permalink"></a></h2><p>In the time domain, we can draw realisations of the process conditioned on the observations and compare it with the data with the function <a href="../api/#Pioran.plot_ppc_timeseries-NTuple{7, Any}"><code>Pioran.plot_ppc_timeseries</code></a>. The predictive time series is plotted with the function <a href="../api/#Pioran.plot_simu_ppc_timeseries-NTuple{5, Any}"><code>Pioran.plot_simu_ppc_timeseries</code></a>.</p><pre><code class="language-julia hljs">figs[3]</code></pre><img src="a31eb58b.png" alt="Example block output"/><div class="admonition is-info" id="Note-e0e9a60b1ecc5ba"><header class="admonition-header">Note<a class="admonition-anchor" href="#Note-e0e9a60b1ecc5ba" title="Permalink"></a></header><div class="admonition-body"><p>As mentioned in <a href="../simulations/#Sampling-from-the-conditioned-distribution">Sampling from the conditioned distribution</a> it can be very expensive to sample from the conditioned distribution, especially if the number of points is large.</p></div></div><p>Finally, we can compute the residuals of the realisations and the data. This figure is plotted using the function <a href="../api/#Pioran.plot_residuals_diagnostics-Tuple{Any, Any, Any}"><code>Pioran.plot_residuals_diagnostics</code></a>. The distribution of the residuals is also plotted, the lower panel shows the autocorrelation of the residuals. One should note that the lags of the autocorrelation are not the same as the lags of the time series. The lags are in indexes of the residuals, therefore it may be difficult to interpret the autocorrelation in terms of time and realisation of a white noise process.</p><pre><code class="language-julia hljs">figs[4]</code></pre><img src="e710154e.png" alt="Example block output"/></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../timeseries/">« Time series and priors</a><a class="docs-footer-nextpage" href="../basis_functions/">About the basis functions »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.13.0 on <span class="colophon-date" title="Tuesday 8 July 2025 23:26">Tuesday 8 July 2025</span>. Using Julia version 1.10.10.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
